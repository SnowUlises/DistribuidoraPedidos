<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Distribuidora Funaz</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin:0; background:#f2f2f2; color:#333; }
    header {
      background:#4a90e2; color:#fff; padding:1em 2em;
      display:flex; align-items:center; gap:1em;
      justify-content: flex-start;
      position: relative;
    }
    footer {
      background: #f8f8f8;
      padding: 1.5em 2em;
      font-family: 'Segoe UI', sans-serif;
      color: #555;
      font-size: 0.9em;
      text-align: center;
      border-top: 1px solid #ddd;
      margin-top: 2em;
    }
    footer .contacto {
      font-weight: bold;
      color: #333;
      margin-bottom: 0.5em;
      text-transform: uppercase;
      font-size: 1em;
    }
    footer .derechos {
      color: #999;
      font-size: 0.8em;
      margin-top: 0.3em;
    }
    header img { height:40px; width:40px; border-radius:50%; }
    header h1 { margin:0; font-size:1.8em; flex-grow: 1; }
    header button, #btnCarrito {
      margin-left: 0.5em;
      padding:8px 12px; border:none; border-radius:6px; background:#fff; color:#4a90e2;
      font-weight:bold; cursor:pointer; white-space: nowrap;
    }
    header button:hover, #btnCarrito:hover { background:#dceeff; }
    .container { display:flex; }
    aside { width:200px; background:#fff; padding:1em; border-right:1px solid #ddd; min-height:100vh; }
    aside h2 { font-size:1.2em; margin-bottom:1em; }
    aside ul { list-style:none; padding:0; }
    aside li { margin:0.5em 0; cursor:pointer; padding:0.5em; border-radius:6px; transition:background 0.2s; }
    aside li:hover, aside li.active { background:#e6f0ff; font-weight:bold; }
    main { flex:1; padding:2em; }
    .ordenar, .paginacion, .cantidad-por-pagina { margin-bottom:1em; display:flex; align-items:center; justify-content:flex-end; gap:0.7em; }
    select { padding:0.5em; border-radius:6px; border:1px solid #ccc; font-size:1em; transition:border 0.2s; }
    select:focus { outline:none; border-color:#4a90e2; }
    .productos {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(var(--cols, 3), 1fr);
    }
    .producto {
      background:#fff;
      border-radius:12px;
      box-shadow:0 2px 10px rgba(0,0,0,0.05);
      padding:1em;
      transition:transform 0.2s;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .producto:hover { transform:scale(1.02); }
    .producto h3 { margin-top:0.5em; text-align:center; }
    .producto img {
      width: 100px; height: 100px;
      border-radius: 10px;
      object-fit: cover;
      margin-bottom: 0.5em;
      pointer-events:none;
    }
    .btn-carrito {
      margin-top:8px;
      background:#4CAF50;
      color:#fff;
      padding:8px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
      width: 100%;
    }
    .btn-carrito:hover {
      background:#388E3C;
    }
    .sin-stock {
      margin-top:8px;
      color: red;
      font-weight: bold;
      text-align: center;
      width: 100%;
    }
    #carritoContainer {
      position: fixed;
      top: 65px;
      right: 20px;
      width: 320px;
      max-height: 400px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      overflow-y: auto;
      display: none;
      z-index: 1000;
      padding: 10px;
    }
    #carritoContainer h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2em;
      text-align: center;
    }
    .item-carrito {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      font-size: 0.95em;
    }
    .item-carrito button {
      background: #d9534f;
      border: none;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9em;
      transition: background 0.2s;
    }
    .item-carrito button:hover {
      background: #c9302c;
    }
    #mensajeCarrito {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      color: black;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      font-weight: bold;
      z-index: 1100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      min-width: 220px;
      max-width: 320px;
    }
    #mensajeCarrito.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .cat-toggle{
      appearance: none;
      -webkit-appearance: none;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(6,59,17,0.06);
      background: #fff;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(6,59,17,0.04);
    }
    .cat-toggle[aria-expanded="true"]{ transform: translateY(-1px); }
    .cat-menu{
      position: absolute;
      right: 0;
      top: calc(100% + 10px);
      min-width: 200px;
      max-height: 320px;
      overflow:auto;
      background: #fff;
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 14px 40px rgba(6,59,17,0.08);
      border: 1px solid rgba(0,0,0,0.04);
      list-style: none;
      margin: 0;
      z-index: 60;
    }
    .cat-menu li{
      margin: 6px 0;
    }
    .cat-menu button {
      width: 100%;
      text-align: left;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
    }
    .cat-menu button:hover { transform: translateX(4px); }
    .cat-menu button.active {
      background: #7ED957;
      color: #05310b;
      font-weight: 800;
      box-shadow: 0 6px 18px rgba(7,50,14,0.06);
    }
  </style>
</head>
<body>
  <header>
    <img id="logoImg" src="" alt="Logo" />
    <h1>Distribuidora Funaz</h1>
    <div style="margin-left:auto; display:flex; gap:0.5em; align-items:center;">
      <button id="btnCarrito">Carrito (0)</button>
    </div>
  </header>
  <div id="carritoContainer" style="display:none;">
    <h3>Carrito de compras</h3>
    <div id="itemsCarrito"></div>
    <div style="margin-top:10px; text-align:center;">
      <button onclick="vaciarCarrito()" style="background:#d9534f; padding:6px 12px; border:none; color:#fff; border-radius:6px; cursor:pointer;">Vaciar carrito</button>
    </div>
    <div style="margin-top:10px; text-align:center;">
      <button onclick="verCarrito()" style="background:#4a90e2; padding:8px 14px; border:none; color:#fff; border-radius:6px; cursor:pointer; font-weight:bold;">
        Ver carrito
      </button>
    </div>
  </div>
  <div class="container">
    <aside>
      <h2>Categorías</h2>
      <ul id="listaCategorias">
        <li class="active" onclick="filtrarCategoria('Todos', this)">Todos</li>
        <li onclick="filtrarCategoria('ALIMENTOS', this)">Alimentos</li>
        <li onclick="filtrarCategoria('ACCESORIOS', this)">Accesorios</li>
        <li onclick="filtrarCategoria('LIMPIEZA', this)">Limpieza</li>
        <li onclick="filtrarCategoria('PERFUMERIA', this)">Perfumeria</li>
        <li onclick="filtrarCategoria('ANALGESICOS', this)">Analgesicos</li>
        <li onclick="filtrarCategoria('ENCENDEDORES', this)">Encendedores</li>
        <li onclick="filtrarCategoria('CREMAS', this)">Cremas</li>
        <li onclick="filtrarCategoria('DESODORANTES', this)">Desodorantes</li>
        <li onclick="filtrarCategoria('GALLETAS Y GOLOSINAS', this)">Galletas y Golosinas</li>
        <li onclick="filtrarCategoria('JUGOS', this)">Jugos</li>
        <li onclick="filtrarCategoria('PAPELES Y BOLSAS', this)">Papeles y Bolsas</li>
        <li onclick="filtrarCategoria('PEGAMENTOS', this)">Pegamentos</li>
        <li onclick="filtrarCategoria('REPELENTES', this)">Repelentes</li>
        <li onclick="filtrarCategoria('SHAMPO Y ENJUAGUE', this)">Shampo y Enjuague</li>
        <li onclick="filtrarCategoria('TINTURAS NANTYR', this)">Tinturas Nantyr</li>
      </ul>
    </aside>
    <main>
      <div class="ordenar">
        Ordenar por:
        <select id="orden" onchange="renderProductos()">
          <option value="nombre">Nombre</option>
          <option value="precioAsc">Precio ↑</option>
          <option value="precioDesc">Precio ↓</option>
        </select>
        <!-- BUSCADOR -->
        <label for="buscador" style="margin-left:12px;">Buscar:</label>
        <input id="buscador" type="search" placeholder="Buscar producto..." style="padding:0.45em; border-radius:6px; border:1px solid #ccc; margin-left:6px;" />
        <div class="cols-wrapper" style="position:relative; flex-shrink: 0;">
          <button id="colsToggle" class="cat-toggle" aria-expanded="false" aria-haspopup="true">
            Columnas: 3 ▾
          </button>
          <ul id="colsMenu" class="cat-menu" hidden role="menu" aria-labelledby="colsToggle"></ul>
        </div>
      </div>
      <div class="productos"></div>
    </main>
  </div>
  <div id="mensajeCarrito"></div>
  <footer>
    <div class="contacto">Información de contacto</div>
    <div class="derechos">Distribuidora Funaz, © 2025. Todos los derechos reservados.</div>
  </footer>
<script>
let productos = [];
let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
let categoriaSeleccionada = 'Todos';
let terminoBusqueda = '';
let currentCols = 3;
const COL_OPTIONS = [3,4,5,6,7,8];
const colsMenu = document.getElementById('colsMenu');
const colsToggle = document.getElementById('colsToggle');
function toggleCarrito() {
  const c = document.getElementById('carritoContainer');
  c.style.display = c.style.display === 'block' ? 'none' : 'block';
  renderCarrito();
}
function verCarrito() {
  if (carrito.length === 0) {
    alert('El carrito está vacío. Agrega productos antes de ver el carrito.');
  } else {
    location.href = 'carrito.html';
  }
}
document.getElementById('btnCarrito').addEventListener('click', toggleCarrito);
async function cargarProductos() {
  try {
    const res = await fetch('https://distribuidorafunaz-a2o6.onrender.com/api/productos');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    productos = await res.json();
    buildColsMenu();
    updateColsToggle();
    renderProductos();
  } catch (err) {
    console.error('Error cargando productos:', err);
    alert('No se pudieron cargar los productos. Revisa la consola.');
  }
}
function filtrarCategoria(categoria, elemento) {
  categoriaSeleccionada = categoria;
  document.querySelectorAll('#listaCategorias li').forEach(li => li.classList.remove('active'));
  elemento.classList.add('active');
  renderProductos();
}
function buildColsMenu(){
  colsMenu.innerHTML = '';
  COL_OPTIONS.forEach(n => {
    const li = document.createElement('li');
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.textContent = n;
    btn.className = (n === currentCols ? 'active' : '');
    btn.onclick = (e) => {
      e.stopPropagation();
      currentCols = n;
      colsMenu.querySelectorAll('button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelector('.productos').style.setProperty('--cols', currentCols);
      updateColsToggle();
      closeColsMenu();
      renderProductos();
    };
    li.appendChild(btn);
    colsMenu.appendChild(li);
  });
}
function updateColsToggle(){
  colsToggle.textContent = `Columnas: ${currentCols} ▾`;
}
function openColsMenu(){
  colsMenu.hidden = false;
  colsToggle.setAttribute('aria-expanded', 'true');
}
function closeColsMenu(){
  colsMenu.hidden = true;
  colsToggle.setAttribute('aria-expanded', 'false');
}
colsToggle.addEventListener('click', (e) => {
  e.stopPropagation();
  if (colsMenu.hidden) {
    buildColsMenu();
    openColsMenu();
  } else {
    closeColsMenu();
  }
});
document.addEventListener('click', (ev) => {
  const outsideCols = !ev.composedPath().includes(colsMenu) && !ev.composedPath().includes(colsToggle);
  if (outsideCols) closeColsMenu();
});
document.addEventListener('keydown', (ev) => { 
  if (ev.key === 'Escape') {
    closeColsMenu();
  }
});
function getImageUrl(fileName) {
  if (!fileName) return '';
  const cleanFileName = fileName.trim().replace(/^imagenes\//, '');
  return `https://slroycxifwezthdomkny.supabase.co/storage/v1/object/public/imagenes/${cleanFileName}`;
}
function renderProductos() {
  const cont = document.querySelector('.productos');
  cont.innerHTML = '';
  let filtrados = productos;
  if (categoriaSeleccionada !== 'Todos') {
    filtrados = productos.filter(p => p.categoria === categoriaSeleccionada);
  }
  const orden = document.getElementById('orden').value;
  if (orden === 'nombre') {
    filtrados.sort((a,b) => a.nombre.localeCompare(b.nombre));
  } else if (orden === 'precioAsc') {
    filtrados.sort((a,b) => a.precio - b.precio);
  } else if (orden === 'precioDesc') {
    filtrados.sort((a,b) => b.precio - a.precio);
  }
  if (terminoBusqueda) {
    filtrados = filtrados.filter(p => {
      const nombre = (p.nombre || '').toString().toLowerCase();
      const desc = (p.descripcion || '').toString().toLowerCase();
      return nombre.includes(terminoBusqueda) || desc.includes(terminoBusqueda);
    });
  }
  filtrados.forEach(p => {
    const div = document.createElement('div');
    div.className = 'producto';
    let accionHTML = '';
    if (p.stock <= -99) {
      accionHTML = '<div class="sin-stock">SIN STOCK</div>';
    } else {
      accionHTML = `<button class="btn-carrito" onclick="agregarAlCarrito(${p.id})">Agregar al carrito</button>`;
    }
    const img = document.createElement('img');
    img.alt = p.nombre;
    img.src = getImageUrl('placeholder.png');
    if (p.imagen) {
      const publicUrl = getImageUrl(p.imagen);
      if (publicUrl) {
        const realImg = new Image();
        realImg.src = publicUrl;
        realImg.onload = () => { img.src = publicUrl; };
        realImg.onerror = () => { img.src = getImageUrl('placeholder.png'); };
      }
    }
    div.innerHTML = `
      <h3>${p.nombre}</h3>
      <div>$${(p.precio * 1.10).toFixed(2)}</div>
      ${accionHTML}
    `;
    div.insertBefore(img, div.firstChild);
    div.style.cursor = 'pointer';
    div.onclick = (event) => {
      if (!event.target.classList.contains('btn-carrito')) {
        window.location.href = `producto.html?id=${p.id}`;
      }
    };
    cont.appendChild(div);
  });
}
function agregarAlCarrito(id, cantidad = 1, silent = false) {
  const producto = productos.find(p => String(p.id) === String(id));

if (!producto) {
  console.error("Producto no encontrado");
  console.log("ID buscado:", id);
  console.log("IDs disponibles:", productos.map(p => p.id));
  console.log("Primeros productos:", productos.slice(0, 5));
  throw new Error("Producto no encontrado");
}

  if (producto.stock <= -99) {
    mostrarMensaje('Producto sin stock. No se puede agregar.');
    return;
  }
  const item = carrito.find(i => i.id === id);
  if (item) item.cantidad += cantidad;
  else carrito.push({ id, cantidad });
  localStorage.setItem('carrito', JSON.stringify(carrito));
  const total = carrito.reduce((acc, i) => acc + i.cantidad, 0);
  const cantidadProducto = carrito.find(i => i.id === id).cantidad;
  actualizarContadorCarrito();
  if (!silent) {
    mostrarMensaje(`Agregaste ${cantidadProducto} × ${producto.nombre}. Total en carrito: ${total}`);
  }
  renderCarrito();
}
function actualizarContadorCarrito() {
  const total = carrito.reduce((acc, i) => acc + i.cantidad, 0);
  document.getElementById('btnCarrito').textContent = `Carrito (${total})`;
}
function renderCarrito() {
  const cont = document.getElementById('itemsCarrito');
  cont.innerHTML = '';
  if(carrito.length === 0){
    cont.innerHTML = '<p>El carrito está vacío.</p>';
    return;
  }
  carrito.forEach(item => {
    const prod = productos.find(p => String(p.id) === String(item.id));
    if (!prod) return;
    const div = document.createElement('div');
    div.className = 'item-carrito';
    div.innerHTML = `
      <span>${prod.nombre} x${item.cantidad}</span>
      <button onclick="eliminarDelCarrito(${item.id})">X</button>
    `;
    cont.appendChild(div);
  });
}
function eliminarDelCarrito(id) {
  carrito = carrito.filter(i => i.id !== id);
  localStorage.setItem('carrito', JSON.stringify(carrito));
  actualizarContadorCarrito();
  renderCarrito();
}
function vaciarCarrito() {
  if(confirm('¿Vaciar todo el carrito?')){
    carrito = [];
    localStorage.setItem('carrito', JSON.stringify(carrito));
    actualizarContadorCarrito();
    renderCarrito();
  }
}
let mensajeTimeout = null;
function mostrarMensaje(texto) {
  const m = document.getElementById('mensajeCarrito');
  m.textContent = texto;
  m.classList.add('visible');
  if (mensajeTimeout) clearTimeout(mensajeTimeout);
  mensajeTimeout = setTimeout(() => {
    m.classList.remove('visible');
    mensajeTimeout = null;
  }, 2600);
}

function keepAlive() {
  console.log("");
}

setInterval(keepAlive, 30000); // cada 30s

  
actualizarContadorCarrito();
cargarProductos();
const buscadorInput = document.getElementById('buscador');
if (buscadorInput) {
  buscadorInput.addEventListener('input', (e) => {
    terminoBusqueda = e.target.value.trim().toLowerCase();
    renderProductos();
  });
}
const logoImg = document.getElementById('logoImg');
logoImg.src = getImageUrl('logo.png');
</script>
</body>
</html>
